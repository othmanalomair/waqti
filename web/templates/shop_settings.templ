package templates

import (
    "waqti/internal/models"
)

templ ShopSettingsPage(creator *models.Creator, settings *models.ShopSettings, successMsg string, lang string, isRTL bool) {
    <!DOCTYPE html>
    <html lang={ lang } dir={ getDirection(isRTL) }>
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>
            if lang == "ar" {
                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± - Waqti.me
            } else {
                Shop Settings - Waqti.me
            }
        </title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"/>

        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'gulf-teal': '#2DD4BF',
                            'ivory-sand': '#FEFCE8',
                            'slate-charcoal': '#1E293B'
                        },
                        fontFamily: {
                            'cairo': ['Cairo', 'sans-serif'],
                            'inter': ['Inter', 'sans-serif']
                        }
                    }
                }
            }
        </script>

        <style>
            .font-primary {
                font-family: { getFontFamily(isRTL) };
            }

            .gradient-bg {
                background: linear-gradient(135deg, #F0FDFA 0%, #FEFCE8 100%);
            }

            .card-shadow {
                box-shadow: 0 4px 20px rgba(45, 212, 191, 0.1);
            }

            .form-input {
                transition: all 0.2s ease-in-out;
            }

            .form-input:focus {
                ring-color: #2DD4BF;
                border-color: #2DD4BF;
                box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.1);
            }

            .logo-upload-area {
                border: 2px dashed #D1D5DB;
                transition: all 0.2s ease-in-out;
            }

            .logo-upload-area:hover {
                border-color: #2DD4BF;
                background-color: rgba(45, 212, 191, 0.05);
            }

            .success-banner {
                background: linear-gradient(90deg, #10B981, #059669);
                animation: slideIn 0.3s ease-out;
            }

            @keyframes slideIn {
                from { transform: translateY(-100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        </style>
    </head>
    <body class="gradient-bg min-h-screen font-primary">

        <!-- Success Message -->
        if successMsg == "1" {
            <div class="success-banner text-white p-4 text-center">
                <div class="max-w-md mx-auto">
                    if lang == "ar" {
                        âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­
                    } else {
                        âœ… Settings saved successfully
                    }
                </div>
            </div>
        }

        <!-- Header with Back Button -->
        <header class="bg-white/80 backdrop-blur-sm border-b border-gulf-teal/20 sticky top-0 z-50">
            <div class="max-w-md mx-auto px-4 py-4">
                <div class="flex items-center space-x-3">
                    <a href="/dashboard" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-slate-charcoal" fill="currentColor" viewBox="0 0 24 24">
                            if isRTL {
                                <path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"/>
                            } else {
                                <path d="M15.41 16.34L10.83 11.75l4.58-4.59L14 5.75l-6 6 6 6z"/>
                            }
                        </svg>
                    </a>
                    <h1 class="text-lg font-bold text-slate-charcoal">
                        if lang == "ar" {
                            Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
                        } else {
                            Shop Settings
                        }
                    </h1>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-md mx-auto px-4 py-6">
            <form method="POST" action="/settings/shop" enctype="multipart/form-data" class="space-y-6">

                <!-- Profile & Branding Section -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-lg font-bold text-slate-charcoal mb-6 flex items-center">
                        <div class="w-8 h-8 bg-gulf-teal/10 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-gulf-teal" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                            </svg>
                        </div>
                        if lang == "ar" {
                            Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©
                        } else {
                            Profile & Branding
                        }
                    </h2>

                    <!-- Profile Picture Upload Section -->
                    <div id="profile-section" class="mb-6">
                        @ProfilePictureSection(settings, lang, isRTL)
                    </div>

                    <!-- Creator Name -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            if lang == "ar" {
                                ğŸ·ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø¦
                            } else {
                                ğŸ·ï¸ Creator Name
                            }
                        </label>
                        <div class="space-y-3">
                            <div>
                                <input
                                    type="text"
                                    name="creator_name"
                                    value={ settings.CreatorName }
                                    placeholder={ getPlaceholder(lang, "creator_name_en") }
                                    class="form-input w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gulf-teal focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200"
                                    required
                                />
                                <p class="text-xs text-gray-500 mt-1 px-1">
                                    if lang == "ar" {
                                        Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ù…Ø·Ù„ÙˆØ¨)
                                    } else {
                                        Name in English (required)
                                    }
                                </p>
                            </div>
                            <div>
                                <input
                                    type="text"
                                    name="creator_name_ar"
                                    value={ settings.CreatorNameAr }
                                    placeholder={ getPlaceholder(lang, "creator_name_ar") }
                                    class="form-input w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gulf-teal focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200"
                                    dir="rtl"
                                />
                                <p class="text-xs text-gray-500 mt-1 px-1" dir="rtl">
                                    if lang == "ar" {
                                        Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                                    } else {
                                        Name in Arabic (optional)
                                    }
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Shop Description -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            if lang == "ar" {
                                ğŸ“ ÙˆØµÙ Ø§Ù„Ù…ØªØ¬Ø±
                            } else {
                                ğŸ“ Shop Description
                            }
                        </label>
                        <div class="space-y-3">
                            <div>
                                <textarea
                                    name="sub_header"
                                    rows="3"
                                    placeholder={ getPlaceholder(lang, "sub_header_en") }
                                    class="form-input w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gulf-teal focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200 resize-none"
                                >{ settings.SubHeader }</textarea>
                                <p class="text-xs text-gray-500 mt-1 px-1">
                                    if lang == "ar" {
                                        ÙˆØµÙ Ù…Ø®ØªØµØ± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
                                    } else {
                                        Brief description in English
                                    }
                                </p>
                            </div>
                            <div>
                                <textarea
                                    name="sub_header_ar"
                                    rows="3"
                                    placeholder={ getPlaceholder(lang, "sub_header_ar") }
                                    class="form-input w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gulf-teal focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200 resize-none"
                                    dir="rtl"
                                >{ settings.SubHeaderAr }</textarea>
                                <p class="text-xs text-gray-500 mt-1 px-1" dir="rtl">
                                    if lang == "ar" {
                                        ÙˆØµÙ Ù…Ø®ØªØµØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                                    } else {
                                        Brief description in Arabic
                                    }
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- WhatsApp Contact -->
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            if lang == "ar" {
                                ğŸ“± Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„
                            } else {
                                ğŸ“± WhatsApp Contact Number
                            }
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <span class="text-gray-500 text-sm">+965</span>
                            </div>
                            <input
                                type="tel"
                                name="contact_whatsapp"
                                value={ settings.ContactWhatsApp }
                                placeholder={ getPlaceholder(lang, "whatsapp") }
                                class="form-input w-full p-4 pl-16 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gulf-teal focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200"
                            />
                        </div>
                        <p class="text-xs text-gray-500 mt-1 px-1">
                            if lang == "ar" {
                                Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                            } else {
                                WhatsApp number for customer direct contact
                            }
                        </p>
                    </div>
                </div>

                <!-- Checkout Preferences -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-lg font-bold text-slate-charcoal mb-6">
                        if lang == "ar" {
                            ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¯ÙØ¹
                        } else {
                            Checkout Preferences
                        }
                    </h2>

                    <!-- Checkout Language -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            if lang == "ar" {
                                Ù„ØºØ© ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
                            } else {
                                Checkout Language
                            }
                        </label>
                        <select
                            name="checkout_language"
                            class="form-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gulf-teal focus:border-transparent"
                        >
                            <option value="ar" selected?={ settings.CheckoutLanguage == "ar" }>
                                if lang == "ar" {
                                    Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·
                                } else {
                                    Arabic Only
                                }
                            </option>
                            <option value="en" selected?={ settings.CheckoutLanguage == "en" }>
                                if lang == "ar" {
                                    Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·
                                } else {
                                    English Only
                                }
                            </option>
                            <option value="both" selected?={ settings.CheckoutLanguage == "both" }>
                                if lang == "ar" {
                                    Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
                                } else {
                                    Both Languages
                                }
                            </option>
                        </select>
                    </div>

                    <!-- Greeting Message -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            if lang == "ar" {
                                Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
                            } else {
                                Greeting Message
                            }
                        </label>
                        <div class="space-y-2">
                            <textarea
                                name="greeting_message"
                                rows="2"
                                placeholder={ getPlaceholder(lang, "greeting_en") }
                                class="form-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gulf-teal focus:border-transparent resize-none"
                            >{ settings.GreetingMessage }</textarea>
                            <textarea
                                name="greeting_message_ar"
                                rows="2"
                                placeholder={ getPlaceholder(lang, "greeting_ar") }
                                class="form-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gulf-teal focus:border-transparent resize-none"
                                dir="rtl"
                            >{ settings.GreetingMessageAr }</textarea>
                        </div>
                    </div>

                    <!-- Currency Symbol -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            if lang == "ar" {
                                Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø©
                            } else {
                                Currency Symbol
                            }
                        </label>
                        <div class="grid grid-cols-2 gap-2">
                            <input
                                type="text"
                                name="currency_symbol"
                                value={ settings.CurrencySymbol }
                                placeholder={ getPlaceholder(lang, "currency_en") }
                                class="form-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gulf-teal focus:border-transparent"
                            />
                            <input
                                type="text"
                                name="currency_symbol_ar"
                                value={ settings.CurrencySymbolAr }
                                placeholder={ getPlaceholder(lang, "currency_ar") }
                                class="form-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gulf-teal focus:border-transparent"
                                dir="rtl"
                            />
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <button
                    type="submit"
                    class="w-full bg-gulf-teal text-white py-4 rounded-xl font-semibold hover:bg-teal-600 transition-colors card-shadow"
                >
                    if lang == "ar" {
                        ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    } else {
                        ğŸ’¾ Save Settings
                    }
                </button>
            </form>

            <!-- Bottom Spacing -->
            <div class="h-6"></div>
        </main>
    </body>
    </html>
}

templ ProfilePictureSection(settings *models.ShopSettings, lang string, isRTL bool) {
    <div class="mb-6">
        <label class="block text-sm font-semibold text-gray-700 mb-3">
            if lang == "ar" {
                ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            } else {
                ğŸ–¼ï¸ Profile Picture
            }
        </label>

        <!-- Current Profile Picture Display -->
        <div class="flex items-center space-x-4 mb-4" id="current-profile-display">
            if settings.LogoURL != "" {
                <div class="relative cursor-pointer" onclick="document.getElementById('profile-upload').click()">
                    <img
                        src={ settings.LogoURL }
                        alt="Current Profile Picture"
                        class="w-20 h-20 rounded-full object-cover border-4 border-gulf-teal/20 shadow-lg hover:shadow-xl transition-all duration-200 hover:border-gulf-teal/40"
                        id="current-profile-img"
                    />
                    <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-gulf-teal rounded-full flex items-center justify-center">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9,16.17L4.83,12l-1.42,1.41L9,19 21,7l-1.41-1.41z"/>
                        </svg>
                    </div>
                    <div class="absolute inset-0 rounded-full bg-black/0 hover:bg-black/10 transition-all duration-200 flex items-center justify-center">
                        <svg class="w-6 h-6 text-white opacity-0 hover:opacity-100 transition-opacity duration-200" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H19M19,5H5V19H19V5Z"/>
                        </svg>
                    </div>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-700 mb-1">
                        if lang == "ar" {
                            Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        } else {
                            Current Picture
                        }
                    </p>
                    <button
                        type="button"
                        onclick="document.getElementById('profile-upload').click()"
                        class="text-gulf-teal text-sm font-semibold hover:text-teal-600 transition-colors"
                    >
                        if lang == "ar" {
                            ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
                        } else {
                            Change Picture
                        }
                    </button>
                </div>
            } else {
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gulf-teal/20 to-gulf-teal/10 border-4 border-gulf-teal/20 flex items-center justify-center cursor-pointer hover:border-gulf-teal/40 transition-all duration-200" onclick="document.getElementById('profile-upload').click()">
                    <svg class="w-8 h-8 text-gulf-teal/60" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                    </svg>
                </div>
                <div class="flex-1">
                    <p class="text-sm text-gray-500 mb-1">
                        if lang == "ar" {
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©
                        } else {
                            No picture set
                        }
                    </p>
                    <button
                        type="button"
                        onclick="document.getElementById('profile-upload').click()"
                        class="text-gulf-teal text-sm font-semibold hover:text-teal-600 transition-colors"
                    >
                        if lang == "ar" {
                            Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©
                        } else {
                            Add Picture
                        }
                    </button>
                </div>
            }
        </div>

        <!-- Hidden File Input -->
        <input
            type="file"
            id="profile-upload"
            name="profile_picture"
            accept="image/jpeg,image/jpg,image/png"
            class="hidden"
            onchange="previewProfileImage(this)"
        />
    </div>

    <script>
        function previewProfileImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                const file = input.files[0];
                
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    input.value = '';
                    return;
                }
                
                reader.onload = function(e) {
                    const currentImg = document.getElementById('current-profile-img');
                    if (currentImg) {
                        currentImg.src = e.target.result;
                    } else {
                        // Create new preview if no current image
                        const display = document.getElementById('current-profile-display');
                        display.innerHTML = `
                            <div class="relative">
                                <img
                                    src="${e.target.result}"
                                    alt="Profile Preview"
                                    class="w-20 h-20 rounded-full object-cover border-4 border-gulf-teal/20 shadow-lg"
                                    id="current-profile-img"
                                />
                                <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,14L6.5,9.5L7.91,8.09L11,11.18L16.59,5.59L18,7L11,14Z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-orange-600 mb-1">New Picture (Preview)</p>
                                <button
                                    type="button"
                                    onclick="document.getElementById('profile-upload').click()"
                                    class="text-gulf-teal text-sm font-semibold hover:text-teal-600 transition-colors"
                                >
                                    Change Picture
                                </button>
                            </div>
                        `;
                    }
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
}
